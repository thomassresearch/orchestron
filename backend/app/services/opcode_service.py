from __future__ import annotations

from collections import defaultdict
from pathlib import Path
import re

from backend.app.models.opcode import OpcodeSpec, PortSpec, SignalType

CSOUND_OVERVIEW_URL = "https://csound.com/docs/manual/PartOpcodesOverview.html"
OPCODE_REFERENCE_URLS: dict[str, str] = {
    "adsr": "https://csound.com/docs/manual/madsr.html",
    "oscili": "https://csound.com/docs/manual/oscili.html",
    "lfo": "https://csound.com/docs/manual/lfo.html",
    "poscil3": "https://csound.com/docs/manual/poscil3.html",
    "syncphasor": "https://csound.com/docs/manual/syncphasor.html",
    "vibr": "https://csound.com/docs/manual/vibr.html",
    "vibrato": "https://csound.com/docs/manual/vibrato.html",
    "vosim": "https://csound.com/docs/manual/vosim.html",
    "voice": "https://csound.com/docs/manual/voice.html",
    "fmb3": "https://csound.com/docs/manual/fmb3.html",
    "fmbell": "https://csound.com/docs/manual/fmbell.html",
    "fmmetal": "https://csound.com/docs/manual/fmmetal.html",
    "fmpercfl": "https://csound.com/docs/manual/fmpercfl.html",
    "fmrhode": "https://csound.com/docs/manual/fmrhode.html",
    "fmvoice": "https://csound.com/docs/manual/fmvoice.html",
    "fmwurlie": "https://csound.com/docs/manual/fmwurlie.html",
    "madsr": "https://csound.com/docs/manual/madsr.html",
    "mxadsr": "https://csound.com/docs/manual/mxadsr.html",
    "pinker": "https://csound.com/docs/manual/pinker.html",
    "noise": "https://csound.com/docs/manual/noise.html",
    "pluck": "https://csound.com/docs/manual/pluck.html",
    "wgpluck2": "https://csound.com/docs/manual/wgpluck2.html",
    "wgflute": "https://csound.com/docs/manual/wgflute.html",
    "wgclar": "https://csound.com/docs/manual/wgclar.html",
    "wgbow": "https://csound.com/docs/manual/wgbow.html",
    "wgbowedbar": "https://csound.com/docs/manual/wgbowedbar.html",
    "wguide2": "https://csound.com/docs/manual/wguide2.html",
    "pan2": "https://csound.com/docs/manual/pan2.html",
    "ntrpol": "https://csound.com/docs/manual/ntrpol.html",
    "vdelay3": "https://csound.com/docs/manual/vdelay3.html",
    "vdelayxs": "https://csound.com/docs/manual/vdelayxs.html",
    "delay": "https://csound.com/docs/manual/delay.html",
    "delayk": "https://csound.com/docs/manual/delayk.html",
    "delayr": "https://csound.com/docs/manual/delayr.html",
    "delayw": "https://csound.com/docs/manual/delayw.html",
    "deltap": "https://csound.com/docs/manual/deltap.html",
    "deltap3": "https://csound.com/docs/manual/deltap3.html",
    "flanger": "https://csound.com/docs/manual/flanger.html",
    "comb": "https://csound.com/docs/manual/comb.html",
    "reverb2": "https://csound.com/docs/manual/reverb2.html",
    "platerev": "https://csound.com/docs/manual/platerev.html",
    "limit": "https://csound.com/docs/manual/limit.html",
    "dam": "https://csound.com/docs/manual/dam.html",
    "exciter": "https://csound.com/docs/manual/exciter.html",
    "distort1": "https://csound.com/docs/manual/distort1.html",
    "gbuzz": "https://csound.com/docs/manual/gbuzz.html",
    "vco": "https://csound.com/docs/manual/vco.html",
    "vco2": "https://csound.com/docs/manual/vco2.html",
    "foscili": "https://csound.com/docs/manual/foscili.html",
    "ftgen": "https://csound.com/docs/manual/ftgen.html",
    "ftgenonce": "https://csound.com/docs/manual/ftgenonce.html",
    "GEN": "https://csound.com/docs/manual/ScoreGenRef.html",
    "ampmidi": "https://csound.com/docs/manual/ampmidi.html",
    "ampmidicurve": "https://csound.com/docs/manual/ampmidicurve.html",
    "ampmidid": "https://csound.com/docs/manual/ampmidid.html",
    "cpsmidi": "https://csound.com/docs/manual/cpsmidi.html",
    "midictrl": "https://csound.com/docs/manual/midictrl.html",
    "notnum": "https://csound.com/docs/manual/notnum.html",
    "k_to_a": "https://csound.com/docs/manual/interp.html",
    "moogladder": "https://csound.com/docs/manual/moogladder.html",
    "moogladder2": "https://csound.com/docs/manual/moogladder2.html",
    "moogvcf": "https://csound.com/docs/manual/moogvcf.html",
    "moog": "https://csound.com/docs/manual/moog.html",
    "diode_ladder": "https://csound.com/docs/manual/diode_ladder.html",
    "rezzy": "https://csound.com/docs/manual/rezzy.html",
    "vclpf": "https://csound.com/docs/manual/vclpf.html",
    "expseg": "https://csound.com/docs/manual/expseg.html",
    "expsega": "https://csound.com/docs/manual/expsega.html",
    "linseg": "https://csound.com/docs/manual/linseg.html",
    "linsegr": "https://csound.com/docs/manual/linsegr.html",
    "marimba": "https://csound.com/docs/manual/marimba.html",
    "dripwater": "https://csound.com/docs/manual/dripwater.html",
    "outs": "https://csound.com/docs/manual/outs.html",
    "tbvcf": "https://csound.com/docs/manual/tbvcf.html",
    "statevar": "https://csound.com/docs/manual/statevar.html",
    "skf": "https://csound.com/docs/manual/skf.html",
    "butterlp": "https://csound.com/docs/manual/butterlp.html",
    "butterbp": "https://csound.com/docs/manual/butterbp.html",
    "butterhp": "https://csound.com/docs/manual/butterhp.html",
    "butterbr": "https://csound.com/docs/manual/butterbr.html",
    "clip": "https://csound.com/docs/manual/clip.html",
    "fold": "https://csound.com/docs/manual/fold.html",
    "fof": "https://csound.com/docs/manual/fof.html",
    "fof2": "https://csound.com/docs/manual/fof2.html",
    "fofilter": "https://csound.com/docs/manual/fofilter.html",
    "outletk": "https://csound.com/docs/manual/outletk.html",
    "outleta": "https://csound.com/docs/manual/outleta.html",
    "inletk": "https://csound.com/docs/manual/inletk.html",
    "inleta": "https://csound.com/docs/manual/inleta.html",
    "rms": "https://csound.com/docs/manual/rms.html",
    "samphold": "https://csound.com/docs/manual/samphold.html",
    "portk": "https://csound.com/docs/manual/portk.html",
    "downsamp": "https://csound.com/docs/manual/downsamp.html",
    "upsamp": "https://csound.com/docs/manual/upsamp.html",
    "sfload": "https://csound.com/docs/manual/sfload.html",
    "sfplay3": "https://csound.com/docs/manual/sfplay3.html",
    "sfinstr3": "https://csound.com/docs/manual/sfinstr3.html",
    "midi_note": "https://csound.com/docs/manual/cpsmidi.html",
}


class OpcodeService:
    def __init__(self, icon_prefix: str) -> None:
        self._icon_prefix = icon_prefix.rstrip("/")
        self._documentation = self._load_opcode_documentation()
        self._opcodes = {opcode.name: opcode for opcode in self._load_builtin_opcodes()}

    def list_opcodes(self, category: str | None = None) -> list[OpcodeSpec]:
        opcodes = list(self._opcodes.values())
        if category:
            opcodes = [opcode for opcode in opcodes if opcode.category == category]
        return sorted(opcodes, key=lambda item: (item.category, item.name))

    def get_opcode(self, name: str) -> OpcodeSpec | None:
        return self._opcodes.get(name)

    def categories(self) -> dict[str, int]:
        counters: dict[str, int] = defaultdict(int)
        for opcode in self._opcodes.values():
            counters[opcode.category] += 1
        return dict(sorted(counters.items(), key=lambda kv: kv[0]))

    def _icon(self, filename: str) -> str:
        return f"{self._icon_prefix}/{filename}"

    def _spec(self, **kwargs: object) -> OpcodeSpec:
        name = str(kwargs["name"])
        description = str(kwargs.get("description", "")).strip()
        fallback_reference = self._reference_url(name)
        documentation_markdown = self._documentation.get(name)
        if not documentation_markdown:
            documentation_markdown = (
                f"### `{name}`\n\n{description}\n\n"
                f"**Reference**\n- [Csound opcode overview]({fallback_reference})"
            )

        return OpcodeSpec(
            documentation_markdown=documentation_markdown,
            documentation_url=fallback_reference,
            **kwargs,
        )

    def _reference_url(self, opcode_name: str) -> str:
        return OPCODE_REFERENCE_URLS.get(opcode_name, CSOUND_OVERVIEW_URL)

    @staticmethod
    def _load_opcode_documentation() -> dict[str, str]:
        docs_path = Path(__file__).resolve().parents[3] / "ADD_OPCODES.md"
        if not docs_path.exists():
            return {}

        text = docs_path.read_text(encoding="utf-8")
        matches = list(re.finditer(r"^### `([^`]+)`.*$", text, flags=re.MULTILINE))
        if not matches:
            return {}

        docs: dict[str, str] = {}
        for index, match in enumerate(matches):
            opcode_name = match.group(1).strip()
            start = match.start()
            end = matches[index + 1].start() if index + 1 < len(matches) else len(text)
            section = text[start:end].strip()
            docs[opcode_name] = section
        return docs

    def _load_builtin_opcodes(self) -> list[OpcodeSpec]:
        return [
            self._spec(
                name="midi_note",
                category="midi",
                description="Extract MIDI note frequency and velocity amplitude.",
                icon=self._icon("midi_note.svg"),
                inputs=[
                    PortSpec(id="gain", name="Gain", signal_type=SignalType.INIT, required=False, default=1),
                ],
                outputs=[
                    PortSpec(id="kfreq", name="kFreq", signal_type=SignalType.CONTROL),
                    PortSpec(id="kamp", name="kAmp", signal_type=SignalType.CONTROL),
                ],
                template="{kfreq} cpsmidi\n{kamp} ampmidi {gain}",
                tags=["performance", "source"],
            ),
            self._spec(
                name="adsr",
                category="envelope",
                description="Control-rate ADSR envelope.",
                icon=self._icon("adsr.svg"),
                inputs=[
                    PortSpec(id="iatt", name="Attack", signal_type=SignalType.INIT, default=0.01),
                    PortSpec(id="idec", name="Decay", signal_type=SignalType.INIT, default=0.15),
                    PortSpec(id="islev", name="Sustain", signal_type=SignalType.INIT, default=0.7),
                    PortSpec(id="irel", name="Release", signal_type=SignalType.INIT, default=0.2),
                ],
                outputs=[PortSpec(id="kenv", name="kEnv", signal_type=SignalType.CONTROL)],
                template="{kenv} madsr {iatt}, {idec}, {islev}, {irel}",
                tags=["control", "modulation"],
            ),
            self._spec(
                name="madsr",
                category="envelope",
                description="MIDI release-sensitive ADSR envelope.",
                icon=self._icon("adsr.svg"),
                inputs=[
                    PortSpec(id="iatt", name="Attack", signal_type=SignalType.INIT, default=0.01),
                    PortSpec(id="idec", name="Decay", signal_type=SignalType.INIT, default=0.15),
                    PortSpec(id="islev", name="Sustain", signal_type=SignalType.INIT, default=0.7),
                    PortSpec(id="irel", name="Release", signal_type=SignalType.INIT, default=0.2),
                    PortSpec(id="idel", name="Delay", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="kenv", name="kEnv", signal_type=SignalType.CONTROL)],
                template="{kenv} madsr {iatt}, {idec}, {islev}, {irel}, {idel}",
                tags=["control", "modulation"],
            ),
            self._spec(
                name="mxadsr",
                category="envelope",
                description="Extended MIDI release-sensitive ADSR envelope.",
                icon=self._icon("adsr.svg"),
                inputs=[
                    PortSpec(id="iatt", name="Attack", signal_type=SignalType.INIT, default=0.01),
                    PortSpec(id="idec", name="Decay", signal_type=SignalType.INIT, default=0.15),
                    PortSpec(id="islev", name="Sustain", signal_type=SignalType.INIT, default=0.7),
                    PortSpec(id="irel", name="Release", signal_type=SignalType.INIT, default=0.2),
                    PortSpec(id="idel", name="Delay", signal_type=SignalType.INIT, required=False, default=0),
                    PortSpec(id="iatss", name="AttackScale", signal_type=SignalType.INIT, required=False, default=0),
                    PortSpec(id="idrss", name="ReleaseScale", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="kenv", name="kEnv", signal_type=SignalType.CONTROL)],
                template="{kenv} mxadsr {iatt}, {idec}, {islev}, {irel}, {idel}, {iatss}, {idrss}",
                tags=["control", "modulation"],
            ),
            self._spec(
                name="expseg",
                category="envelope",
                description="Control-rate exponential breakpoint envelope generator.",
                icon=self._icon("adsr.svg"),
                inputs=[
                    PortSpec(id="ia", name="Start", signal_type=SignalType.INIT, default=0.001, description="Start value"),
                    PortSpec(id="idur1", name="Dur1", signal_type=SignalType.INIT, default=0.05),
                    PortSpec(id="ib", name="Val1", signal_type=SignalType.INIT, default=1.0),
                    PortSpec(id="idur2", name="Dur2", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="ic", name="Val2", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="idur3", name="Dur3", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="id", name="Val3", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="idur4", name="Dur4", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="ie", name="Val4", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="kenv", name="kEnv", signal_type=SignalType.CONTROL)],
                template="{kenv} expseg {ia}, {idur1}, {ib}, {idur2}, {ic}, {idur3}, {id}, {idur4}, {ie}",
                tags=["control", "envelope", "segments"],
            ),
            self._spec(
                name="expsega",
                category="envelope",
                description="Audio-rate exponential breakpoint envelope generator.",
                icon=self._icon("adsr.svg"),
                inputs=[
                    PortSpec(id="ia", name="Start", signal_type=SignalType.INIT, default=0.001, description="Start value"),
                    PortSpec(id="idur1", name="Dur1", signal_type=SignalType.INIT, default=0.05),
                    PortSpec(id="ib", name="Val1", signal_type=SignalType.INIT, default=1.0),
                    PortSpec(id="idur2", name="Dur2", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="ic", name="Val2", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="idur3", name="Dur3", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="id", name="Val3", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="idur4", name="Dur4", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="ie", name="Val4", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="aenv", name="aEnv", signal_type=SignalType.AUDIO)],
                template="{aenv} expsega {ia}, {idur1}, {ib}, {idur2}, {ic}, {idur3}, {id}, {idur4}, {ie}",
                tags=["audio", "envelope", "segments"],
            ),
            self._spec(
                name="linseg",
                category="envelope",
                description="Control-rate linear breakpoint envelope generator.",
                icon=self._icon("adsr.svg"),
                inputs=[
                    PortSpec(id="ia", name="Start", signal_type=SignalType.INIT, default=0),
                    PortSpec(id="idur1", name="Dur1", signal_type=SignalType.INIT, default=0.05),
                    PortSpec(id="ib", name="Val1", signal_type=SignalType.INIT, default=1.0),
                    PortSpec(id="idur2", name="Dur2", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="ic", name="Val2", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="idur3", name="Dur3", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="id", name="Val3", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="kenv", name="kEnv", signal_type=SignalType.CONTROL)],
                template="{kenv} linseg {ia}, {idur1}, {ib}, {idur2}, {ic}, {idur3}, {id}",
                tags=["control", "envelope", "segments", "line"],
            ),
            self._spec(
                name="linsegr",
                category="envelope",
                description="Control-rate linear breakpoint envelope with release segment.",
                icon=self._icon("adsr.svg"),
                inputs=[
                    PortSpec(id="ia", name="Start", signal_type=SignalType.INIT, default=0),
                    PortSpec(id="idur1", name="Dur1", signal_type=SignalType.INIT, default=0.05),
                    PortSpec(id="ib", name="Val1", signal_type=SignalType.INIT, default=1.0),
                    PortSpec(id="irel", name="ReleaseDur", signal_type=SignalType.INIT, default=0.1),
                    PortSpec(id="iz", name="ReleaseVal", signal_type=SignalType.INIT, default=0),
                ],
                outputs=[PortSpec(id="kenv", name="kEnv", signal_type=SignalType.CONTROL)],
                template="{kenv} linsegr {ia}, {idur1}, {ib}, {irel}, {iz}",
                tags=["control", "envelope", "segments", "release"],
            ),
            self._spec(
                name="oscili",
                category="oscillator",
                description="Classic interpolating oscillator.",
                icon=self._icon("oscili.svg"),
                inputs=[
                    PortSpec(id="amp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.4),
                    PortSpec(
                        id="freq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=440,
                    ),
                    PortSpec(id="ifn", name="FunctionTable", signal_type=SignalType.INIT, default=1),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template="{asig} oscili {amp}, {freq}, {ifn}",
                tags=["sound", "source"],
            ),
            self._spec(
                name="poscil3",
                category="oscillator",
                description="High-precision cubic interpolating oscillator.",
                icon=self._icon("oscili.svg"),
                inputs=[
                    PortSpec(
                        id="amp",
                        name="Amplitude",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=0.4,
                    ),
                    PortSpec(
                        id="freq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=440,
                    ),
                    PortSpec(id="ifn", name="FunctionTable", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="iphs", name="Phase", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template="{asig} poscil3 {amp}, {freq}, {ifn}, {iphs}",
                tags=["sound", "source"],
            ),
            self._spec(
                name="syncphasor",
                category="oscillator",
                description="Audio-rate normalized phase generator with sync trigger I/O.",
                icon=self._icon("oscili.svg"),
                inputs=[
                    PortSpec(
                        id="xcps",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=440,
                    ),
                    PortSpec(id="asyncin", name="aSyncIn", signal_type=SignalType.AUDIO, default=0),
                    PortSpec(id="iphs", name="Phase", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[
                    PortSpec(id="aphase", name="aPhase", signal_type=SignalType.AUDIO),
                    PortSpec(id="asyncout", name="aSyncOut", signal_type=SignalType.AUDIO),
                ],
                template="{aphase}, {asyncout} syncphasor {xcps}, {asyncin}, {iphs}",
                tags=["phase", "sync", "oscillator", "modulation"],
            ),
            self._spec(
                name="gbuzz",
                category="oscillator",
                description="Generalized buzz oscillator with controllable harmonics.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(
                        id="xamp",
                        name="Amplitude",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=0.4,
                    ),
                    PortSpec(
                        id="xcps",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=220,
                    ),
                    PortSpec(id="knh", name="Harmonics", signal_type=SignalType.CONTROL, default=10),
                    PortSpec(id="klh", name="LowestHarmonic", signal_type=SignalType.CONTROL, default=1),
                    PortSpec(id="kmul", name="HarmonicMul", signal_type=SignalType.CONTROL, default=1),
                    PortSpec(id="ifn", name="FunctionTable", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="iphs", name="Phase", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template="{asig} gbuzz {xamp}, {xcps}, {knh}, {klh}, {kmul}, {ifn}, {iphs}",
                tags=["sound", "source", "additive", "harmonics"],
            ),
            self._spec(
                name="fof",
                category="oscillator",
                description="Formant/granular source using sinusoid bursts.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(
                        id="xamp",
                        name="Amplitude",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=0.2,
                    ),
                    PortSpec(
                        id="xfund",
                        name="Fundamental",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=100,
                    ),
                    PortSpec(
                        id="xform",
                        name="FormantFreq",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=800,
                    ),
                    PortSpec(id="koct", name="Octaviation", signal_type=SignalType.CONTROL, default=0),
                    PortSpec(id="kband", name="Bandwidth", signal_type=SignalType.CONTROL, default=90),
                    PortSpec(id="kris", name="Rise", signal_type=SignalType.CONTROL, default=0.003),
                    PortSpec(id="kdur", name="Dur", signal_type=SignalType.CONTROL, default=0.02),
                    PortSpec(id="kdec", name="Decay", signal_type=SignalType.CONTROL, default=0.007),
                    PortSpec(id="iolaps", name="Overlaps", signal_type=SignalType.INIT, default=100),
                    PortSpec(id="ifna", name="SineTable", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="ifnb", name="EnvTable", signal_type=SignalType.INIT, default=2),
                    PortSpec(id="itotdur", name="TotalDur", signal_type=SignalType.INIT, default="p3"),
                    PortSpec(id="iphs", name="Phase", signal_type=SignalType.INIT, required=False, default=0),
                    PortSpec(id="ifmode", name="FormantMode", signal_type=SignalType.INIT, required=False, default=0),
                    PortSpec(id="iskip", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template=(
                    "{asig} fof {xamp}, {xfund}, {xform}, {koct}, {kband}, {kris}, {kdur}, {kdec}, "
                    "{iolaps}, {ifna}, {ifnb}, {itotdur}, {iphs}, {ifmode}, {iskip}"
                ),
                tags=["sound", "source", "formant", "granular"],
            ),
            self._spec(
                name="fof2",
                category="oscillator",
                description="FOF source with per-grain phase indexing and glissando.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(
                        id="xamp",
                        name="Amplitude",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=0.2,
                    ),
                    PortSpec(
                        id="xfund",
                        name="Fundamental",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=100,
                    ),
                    PortSpec(
                        id="xform",
                        name="FormantFreq",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=800,
                    ),
                    PortSpec(id="koct", name="Octaviation", signal_type=SignalType.CONTROL, default=0),
                    PortSpec(id="kband", name="Bandwidth", signal_type=SignalType.CONTROL, default=90),
                    PortSpec(id="kris", name="Rise", signal_type=SignalType.CONTROL, default=0.003),
                    PortSpec(id="kdur", name="Dur", signal_type=SignalType.CONTROL, default=0.02),
                    PortSpec(id="kdec", name="Decay", signal_type=SignalType.CONTROL, default=0.007),
                    PortSpec(id="iolaps", name="Overlaps", signal_type=SignalType.INIT, default=100),
                    PortSpec(id="ifna", name="SineTable", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="ifnb", name="EnvTable", signal_type=SignalType.INIT, default=2),
                    PortSpec(id="itotdur", name="TotalDur", signal_type=SignalType.INIT, default="p3"),
                    PortSpec(id="kphs", name="PhaseIndex", signal_type=SignalType.CONTROL, default=0),
                    PortSpec(id="kgliss", name="Gliss", signal_type=SignalType.CONTROL, default=0),
                    PortSpec(id="iskip", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template=(
                    "{asig} fof2 {xamp}, {xfund}, {xform}, {koct}, {kband}, {kris}, {kdur}, {kdec}, "
                    "{iolaps}, {ifna}, {ifnb}, {itotdur}, {kphs}, {kgliss}, {iskip}"
                ),
                tags=["sound", "source", "formant", "granular"],
            ),
            self._spec(
                name="voice",
                category="oscillator",
                description="Formant-based vocal source synthesizer.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="kamp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.2),
                    PortSpec(id="kfreq", name="Frequency", signal_type=SignalType.CONTROL, default=220),
                    PortSpec(id="kphoneme", name="Phoneme", signal_type=SignalType.CONTROL, default=0),
                    PortSpec(id="kform", name="Formant", signal_type=SignalType.CONTROL, default=0),
                    PortSpec(id="kvibf", name="VibratoRate", signal_type=SignalType.CONTROL, default=0),
                    PortSpec(id="kvamp", name="VibratoDepth", signal_type=SignalType.CONTROL, default=0),
                    PortSpec(id="ifn", name="ExcitationTable", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="ivfn", name="VibratoTable", signal_type=SignalType.INIT, default=1),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template="{asig} voice {kamp}, {kfreq}, {kphoneme}, {kform}, {kvibf}, {kvamp}, {ifn}, {ivfn}",
                tags=["sound", "source", "vocal", "formant"],
            ),
            self._spec(
                name="vosim",
                category="oscillator",
                description="Vocal formant synthesis using overlapping sinusoidal bursts.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="kamp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.2),
                    PortSpec(id="kfund", name="Fundamental", signal_type=SignalType.CONTROL, default=110),
                    PortSpec(id="kform", name="Formant", signal_type=SignalType.CONTROL, default=800),
                    PortSpec(id="kdec", name="Decay", signal_type=SignalType.CONTROL, default=0.05),
                    PortSpec(id="kpulsecount", name="PulseCount", signal_type=SignalType.CONTROL, default=3),
                    PortSpec(id="kpulsefactor", name="PulseFactor", signal_type=SignalType.CONTROL, default=1),
                    PortSpec(id="ifn", name="FunctionTable", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="iskip", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template=(
                    "{asig} vosim {kamp}, {kfund}, {kform}, {kdec}, "
                    "{kpulsecount}, {kpulsefactor}, {ifn}, {iskip}"
                ),
                tags=["sound", "source", "vocal", "formant"],
            ),
            self._spec(
                name="lfo",
                category="modulation",
                description="Low-frequency oscillator for control-rate modulation.",
                icon=self._icon("oscili.svg"),
                inputs=[
                    PortSpec(
                        id="kamp",
                        name="Amplitude",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=0.5,
                    ),
                    PortSpec(
                        id="kcps",
                        name="Rate",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=5,
                    ),
                    PortSpec(id="itype", name="Waveform", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="kout", name="kOut", signal_type=SignalType.CONTROL)],
                template="{kout} lfo {kamp}, {kcps}, {itype}",
                tags=["control", "modulation", "lfo"],
            ),
            self._spec(
                name="vibr",
                category="modulation",
                description="Simple vibrato control oscillator with table lookup.",
                icon=self._icon("oscili.svg"),
                inputs=[
                    PortSpec(
                        id="amp",
                        name="Amplitude",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=0.01,
                    ),
                    PortSpec(
                        id="cps",
                        name="Rate",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=6,
                    ),
                    PortSpec(id="ifn", name="FunctionTable", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="iphs", name="Phase", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="kout", name="kOut", signal_type=SignalType.CONTROL)],
                template="{kout} vibr {amp}, {cps}, {ifn}, {iphs}",
                tags=["control", "modulation", "vibrato"],
            ),
            self._spec(
                name="vibrato",
                category="modulation",
                description="Randomized vibrato generator.",
                icon=self._icon("oscili.svg"),
                inputs=[
                    PortSpec(id="kavgamp", name="AverageAmp", signal_type=SignalType.CONTROL, default=0.01),
                    PortSpec(id="kavgfreq", name="AverageFreq", signal_type=SignalType.CONTROL, default=6),
                    PortSpec(id="krandamp", name="RandAmp", signal_type=SignalType.CONTROL, default=0.05),
                    PortSpec(id="krandfreq", name="RandFreq", signal_type=SignalType.CONTROL, default=0.1),
                    PortSpec(id="kampminrate", name="AmpMinRate", signal_type=SignalType.CONTROL, default=3),
                    PortSpec(id="kampmaxrate", name="AmpMaxRate", signal_type=SignalType.CONTROL, default=7),
                    PortSpec(id="kcpsminrate", name="FreqMinRate", signal_type=SignalType.CONTROL, default=3),
                    PortSpec(id="kcpsmaxrate", name="FreqMaxRate", signal_type=SignalType.CONTROL, default=7),
                    PortSpec(id="ifn", name="FunctionTable", signal_type=SignalType.INIT, default=1),
                ],
                outputs=[PortSpec(id="kout", name="kOut", signal_type=SignalType.CONTROL)],
                template=(
                    "{kout} vibrato {kavgamp}, {kavgfreq}, {krandamp}, {krandfreq}, {kampminrate}, "
                    "{kampmaxrate}, {kcpsminrate}, {kcpsmaxrate}, {ifn}"
                ),
                tags=["control", "modulation", "vibrato"],
            ),
            self._spec(
                name="samphold",
                category="modulation",
                description="Control-rate sample-and-hold processor.",
                icon=self._icon("oscili.svg"),
                inputs=[
                    PortSpec(
                        id="ksig",
                        name="kIn",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=0,
                    ),
                    PortSpec(
                        id="kgate",
                        name="Gate",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=1,
                    ),
                    PortSpec(id="ival", name="InitValue", signal_type=SignalType.INIT, required=False, default=0),
                    PortSpec(id="ivstor", name="InitStore", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="kout", name="kOut", signal_type=SignalType.CONTROL)],
                template="{kout} samphold {ksig}, {kgate}, {ival}, {ivstor}",
                tags=["control", "modulation", "sample-and-hold"],
            ),
            self._spec(
                name="portk",
                category="modulation",
                description="Control-rate portamento/slew limiter with optional init value.",
                icon=self._icon("oscili.svg"),
                inputs=[
                    PortSpec(
                        id="ksig",
                        name="kIn",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                    ),
                    PortSpec(
                        id="khtim",
                        name="HalfTime",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=0.05,
                    ),
                    PortSpec(id="isig", name="InitValue", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="kout", name="kOut", signal_type=SignalType.CONTROL)],
                template="{kout} portk {ksig}, {khtim}, {isig}",
                tags=["control", "modulation", "portamento", "smoothing"],
            ),
            self._spec(
                name="fmb3",
                category="fm",
                description="B3 organ FM model.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="kamp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.4),
                    PortSpec(
                        id="kfreq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=440,
                    ),
                    PortSpec(id="kindex", name="ModIndex", signal_type=SignalType.CONTROL, default=2),
                    PortSpec(id="kcrossfreq", name="CrossFreq", signal_type=SignalType.CONTROL, default=2),
                    PortSpec(id="kvrate", name="VibratoRate", signal_type=SignalType.CONTROL, default=6),
                    PortSpec(id="ifn1", name="CarrierTable1", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="ifn2", name="CarrierTable2", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="ifn3", name="ModTable1", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="ifn4", name="ModTable2", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="ivfn", name="VibratoTable", signal_type=SignalType.INIT, required=False, default=1),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template=(
                    "{asig} fmb3 {kamp}, {kfreq}, {kindex}, {kcrossfreq}, {kvrate}, "
                    "{ifn1}, {ifn2}, {ifn3}, {ifn4}, {ivfn}"
                ),
                tags=["sound", "fm", "source"],
            ),
            self._spec(
                name="fmbell",
                category="fm",
                description="Bell FM model.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="kamp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.4),
                    PortSpec(
                        id="kfreq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=440,
                    ),
                    PortSpec(id="kc1", name="CarrierRatio1", signal_type=SignalType.CONTROL, default=2),
                    PortSpec(id="kc2", name="CarrierRatio2", signal_type=SignalType.CONTROL, default=3),
                    PortSpec(id="kvdepth", name="VibratoDepth", signal_type=SignalType.CONTROL, default=0.1),
                    PortSpec(id="kvrate", name="VibratoRate", signal_type=SignalType.CONTROL, default=6),
                    PortSpec(id="ifn1", name="CarrierTable1", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="ifn2", name="CarrierTable2", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="ifn3", name="ModTable1", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="ifn4", name="ModTable2", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="ivfn", name="VibratoTable", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="isus", name="SustainFlag", signal_type=SignalType.INIT, required=False, default=4),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template=(
                    "{asig} fmbell {kamp}, {kfreq}, {kc1}, {kc2}, {kvdepth}, {kvrate}, "
                    "{ifn1}, {ifn2}, {ifn3}, {ifn4}, {ivfn}, {isus}"
                ),
                tags=["sound", "fm", "source"],
            ),
            self._spec(
                name="fmmetal",
                category="fm",
                description="Metallic FM model.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="kamp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.4),
                    PortSpec(
                        id="kfreq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=440,
                    ),
                    PortSpec(id="kc1", name="CarrierRatio1", signal_type=SignalType.CONTROL, default=2),
                    PortSpec(id="kc2", name="CarrierRatio2", signal_type=SignalType.CONTROL, default=3),
                    PortSpec(id="kvdepth", name="VibratoDepth", signal_type=SignalType.CONTROL, default=0.1),
                    PortSpec(id="kvrate", name="VibratoRate", signal_type=SignalType.CONTROL, default=6),
                    PortSpec(id="ifn1", name="CarrierTable1", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="ifn2", name="CarrierTable2", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="ifn3", name="ModTable1", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="ifn4", name="ModTable2", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="ivfn", name="VibratoTable", signal_type=SignalType.INIT, default=1),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template=(
                    "{asig} fmmetal {kamp}, {kfreq}, {kc1}, {kc2}, {kvdepth}, {kvrate}, "
                    "{ifn1}, {ifn2}, {ifn3}, {ifn4}, {ivfn}"
                ),
                tags=["sound", "fm", "source"],
            ),
            self._spec(
                name="fmpercfl",
                category="fm",
                description="Percussive flute FM model.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="kamp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.4),
                    PortSpec(
                        id="kfreq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=440,
                    ),
                    PortSpec(id="kc1", name="CarrierRatio1", signal_type=SignalType.CONTROL, default=2),
                    PortSpec(id="kc2", name="CarrierRatio2", signal_type=SignalType.CONTROL, default=3),
                    PortSpec(id="kvdepth", name="VibratoDepth", signal_type=SignalType.CONTROL, default=0.1),
                    PortSpec(id="kvrate", name="VibratoRate", signal_type=SignalType.CONTROL, default=6),
                    PortSpec(id="ifn1", name="CarrierTable1", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="ifn2", name="CarrierTable2", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="ifn3", name="ModTable1", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="ifn4", name="ModTable2", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="ivfn", name="VibratoTable", signal_type=SignalType.INIT, required=False, default=1),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template=(
                    "{asig} fmpercfl {kamp}, {kfreq}, {kc1}, {kc2}, {kvdepth}, {kvrate}, "
                    "{ifn1}, {ifn2}, {ifn3}, {ifn4}, {ivfn}"
                ),
                tags=["sound", "fm", "source"],
            ),
            self._spec(
                name="fmrhode",
                category="fm",
                description="Rhodes electric piano FM model.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="kamp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.4),
                    PortSpec(
                        id="kfreq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=440,
                    ),
                    PortSpec(id="kc1", name="CarrierRatio1", signal_type=SignalType.CONTROL, default=2),
                    PortSpec(id="kc2", name="CarrierRatio2", signal_type=SignalType.CONTROL, default=3),
                    PortSpec(id="kvdepth", name="VibratoDepth", signal_type=SignalType.CONTROL, default=0.1),
                    PortSpec(id="kvrate", name="VibratoRate", signal_type=SignalType.CONTROL, default=6),
                    PortSpec(id="ifn1", name="CarrierTable1", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="ifn2", name="CarrierTable2", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="ifn3", name="ModTable1", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="ifn4", name="ModTable2", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="ivfn", name="VibratoTable", signal_type=SignalType.INIT, default=1),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template=(
                    "{asig} fmrhode {kamp}, {kfreq}, {kc1}, {kc2}, {kvdepth}, {kvrate}, "
                    "{ifn1}, {ifn2}, {ifn3}, {ifn4}, {ivfn}"
                ),
                tags=["sound", "fm", "source"],
            ),
            self._spec(
                name="fmvoice",
                category="fm",
                description="Voice-like FM model.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="kamp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.4),
                    PortSpec(
                        id="kfreq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=440,
                    ),
                    PortSpec(id="kc1", name="Vowel", signal_type=SignalType.CONTROL, default=2),
                    PortSpec(id="kc2", name="Tilt", signal_type=SignalType.CONTROL, default=3),
                    PortSpec(id="kvdepth", name="VibratoAmount", signal_type=SignalType.CONTROL, default=0.1),
                    PortSpec(id="kvrate", name="VibratoRate", signal_type=SignalType.CONTROL, default=6),
                    PortSpec(id="ifn1", name="WaveTable1", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="ifn2", name="WaveTable2", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="ifn3", name="WaveTable3", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="ifn4", name="WaveTable4", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="ivfn", name="VibratoTable", signal_type=SignalType.INIT, required=False, default=1),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template=(
                    "{asig} fmvoice {kamp}, {kfreq}, {kc1}, {kc2}, {kvdepth}, {kvrate}, "
                    "{ifn1}, {ifn2}, {ifn3}, {ifn4}, {ivfn}"
                ),
                tags=["sound", "fm", "source"],
            ),
            self._spec(
                name="fmwurlie",
                category="fm",
                description="Wurlitzer electric piano FM model.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="kamp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.4),
                    PortSpec(
                        id="kfreq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=440,
                    ),
                    PortSpec(id="kc1", name="CarrierRatio1", signal_type=SignalType.CONTROL, default=2),
                    PortSpec(id="kc2", name="CarrierRatio2", signal_type=SignalType.CONTROL, default=3),
                    PortSpec(id="kvdepth", name="VibratoDepth", signal_type=SignalType.CONTROL, default=0.1),
                    PortSpec(id="kvrate", name="VibratoRate", signal_type=SignalType.CONTROL, default=6),
                    PortSpec(id="ifn1", name="CarrierTable1", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="ifn2", name="CarrierTable2", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="ifn3", name="ModTable1", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="ifn4", name="ModTable2", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="ivfn", name="VibratoTable", signal_type=SignalType.INIT, default=1),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template=(
                    "{asig} fmwurlie {kamp}, {kfreq}, {kc1}, {kc2}, {kvdepth}, {kvrate}, "
                    "{ifn1}, {ifn2}, {ifn3}, {ifn4}, {ivfn}"
                ),
                tags=["sound", "fm", "source"],
            ),
            self._spec(
                name="vco",
                category="oscillator",
                description="Band-limited voltage-controlled oscillator.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="amp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.4),
                    PortSpec(
                        id="freq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=440,
                    ),
                    PortSpec(
                        id="iwave",
                        name="Waveform",
                        signal_type=SignalType.INIT,
                        required=False,
                        default=1,
                    ),
                    PortSpec(
                        id="kpw",
                        name="PulseWidth",
                        signal_type=SignalType.CONTROL,
                        required=False,
                        default=0.5,
                    ),
                    PortSpec(
                        id="ifn",
                        name="FunctionTable",
                        signal_type=SignalType.INIT,
                        required=False,
                    ),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template="{asig} vco {amp}, {freq}, {iwave}, {kpw}, {ifn}",
                tags=["sound", "source"],
            ),
            self._spec(
                name="vco2",
                category="oscillator",
                description="Improved anti-aliased analog-style oscillator.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(
                        id="kamp",
                        name="Amplitude",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=0.4,
                    ),
                    PortSpec(
                        id="kcps",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=440,
                    ),
                    PortSpec(id="imode", name="Mode", signal_type=SignalType.INIT, required=False, default=0),
                    PortSpec(
                        id="kpw",
                        name="PulseWidth",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        required=False,
                        default=0.5,
                    ),
                    PortSpec(
                        id="kphs",
                        name="Phase",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        required=False,
                        default=0,
                    ),
                    PortSpec(id="inyx", name="SyncShape", signal_type=SignalType.INIT, required=False, default=0.5),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template="{asig} vco2 {kamp}, {kcps}, {imode}, {kpw}, {kphs}, {inyx}",
                tags=["sound", "analog", "source"],
            ),
            self._spec(
                name="moog",
                category="oscillator",
                description="Mini-Moog style synthesizer model source.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(
                        id="kamp",
                        name="Amplitude",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=0.15,
                    ),
                    PortSpec(
                        id="kfreq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=440,
                    ),
                    PortSpec(
                        id="kfiltq",
                        name="FilterQ",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=0.85,
                    ),
                    PortSpec(
                        id="kfiltrate",
                        name="FilterRate",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=0.0002,
                    ),
                    PortSpec(
                        id="kvibf",
                        name="VibratoFreq",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=5,
                    ),
                    PortSpec(
                        id="kvamp",
                        name="VibratoAmp",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=0.01,
                    ),
                    PortSpec(id="iafn", name="AttackTable", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="iwfn", name="WaveTable", signal_type=SignalType.INIT, default=2),
                    PortSpec(id="ivfn", name="VibratoTable", signal_type=SignalType.INIT, default=3),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template=(
                    "{asig} moog {kamp}, {kfreq}, {kfiltq}, {kfiltrate}, {kvibf}, "
                    "{kvamp}, {iafn}, {iwfn}, {ivfn}"
                ),
                tags=["sound", "analog", "source", "moog"],
            ),
            self._spec(
                name="foscili",
                category="oscillator",
                description="Audio-rate FM oscillator with harmonic ratios.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(
                        id="xamp",
                        name="Amplitude",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=0.4,
                    ),
                    PortSpec(
                        id="kcps",
                        name="BaseFrequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=220,
                    ),
                    PortSpec(
                        id="xcar",
                        name="CarrierRatio",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=1,
                    ),
                    PortSpec(
                        id="xmod",
                        name="ModRatio",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=2,
                    ),
                    PortSpec(
                        id="kndx",
                        name="ModIndex",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=2,
                    ),
                    PortSpec(id="ifn", name="FunctionTable", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="iphs", name="Phase", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template="{asig} foscili {xamp}, {kcps}, {xcar}, {xmod}, {kndx}, {ifn}, {iphs}",
                tags=["sound", "fm", "source"],
            ),
            self._spec(
                name="GEN",
                category="tables",
                description=(
                    "Routine-aware function table generator (meta-opcode) that renders ftgen/ftgenonce "
                    "from a specialized editor."
                ),
                icon=self._icon("ftgen.svg"),
                inputs=[],
                outputs=[PortSpec(id="ift", name="iFn", signal_type=SignalType.INIT)],
                template="; GEN meta-opcode is rendered by the compiler",
                tags=["source", "tables", "gen", "meta"],
            ),
            self._spec(
                name="ftgen",
                category="tables",
                description="Create a function table at init time using a GEN routine.",
                icon=self._icon("ftgen.svg"),
                inputs=[
                    PortSpec(id="ifn", name="TableNumber", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="itime", name="StartTime", signal_type=SignalType.INIT, default=0),
                    PortSpec(id="isize", name="TableSize", signal_type=SignalType.INIT, default=16384),
                    PortSpec(id="igen", name="GenRoutine", signal_type=SignalType.INIT, default=10),
                    PortSpec(id="iarg1", name="Arg1", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="iarg2", name="Arg2", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="iarg3", name="Arg3", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="iarg4", name="Arg4", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="iarg5", name="Arg5", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="iarg6", name="Arg6", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="iarg7", name="Arg7", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="iarg8", name="Arg8", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="ift", name="iFn", signal_type=SignalType.INIT)],
                template=(
                    "{ift} ftgen {ifn}, {itime}, {isize}, {igen}, {iarg1}, "
                    "{iarg2}, {iarg3}, {iarg4}, {iarg5}, {iarg6}, {iarg7}, {iarg8}"
                ),
                tags=["source", "tables", "gen"],
            ),
            self._spec(
                name="ftgenonce",
                category="tables",
                description="Generate a function table once and reuse it across instances.",
                icon=self._icon("ftgen.svg"),
                inputs=[
                    PortSpec(id="ip1", name="TableNumber", signal_type=SignalType.INIT, default=0),
                    PortSpec(id="ip2dummy", name="Dummy", signal_type=SignalType.INIT, default=0),
                    PortSpec(id="isize", name="TableSize", signal_type=SignalType.INIT, default=16384),
                    PortSpec(id="igen", name="GenRoutine", signal_type=SignalType.INIT, default=10),
                    PortSpec(id="iarg1", name="Arg1", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="iarg2", name="Arg2", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="iarg3", name="Arg3", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="iarg4", name="Arg4", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="iarg5", name="Arg5", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="iarg6", name="Arg6", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="iarg7", name="Arg7", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="iarg8", name="Arg8", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="ift", name="iFn", signal_type=SignalType.INIT)],
                template=(
                    "{ift} ftgenonce {ip1}, {ip2dummy}, {isize}, {igen}, {iarg1}, "
                    "{iarg2}, {iarg3}, {iarg4}, {iarg5}, {iarg6}, {iarg7}, {iarg8}"
                ),
                tags=["source", "tables", "gen"],
            ),
            self._spec(
                name="sfload",
                category="soundfont",
                description="Load a SoundFont2 file and return a file handle.",
                icon=self._icon("ftgen.svg"),
                inputs=[],
                outputs=[PortSpec(id="ifilhandle", name="iFileHandle", signal_type=SignalType.INIT)],
                template='{ifilhandle} sfload "<configured-sf2-file>"',
                tags=["soundfont", "loader", "init", "source"],
            ),
            self._spec(
                name="sfplay3",
                category="soundfont",
                description="Play a SoundFont preset as stereo audio with cubic interpolation.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="ivel", name="Velocity", signal_type=SignalType.INIT, default=100),
                    PortSpec(id="inotenum", name="MidiNote", signal_type=SignalType.INIT, default=60),
                    PortSpec(
                        id="xamp",
                        name="Amplitude",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=1,
                    ),
                    PortSpec(
                        id="xfreq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=1,
                    ),
                    PortSpec(id="ipreindex", name="PresetIndex", signal_type=SignalType.INIT, default=0),
                    PortSpec(id="iflag", name="FreqMode", signal_type=SignalType.INIT, required=False, default=0),
                    PortSpec(id="ioffset", name="Offset", signal_type=SignalType.INIT, required=False, default=0),
                    PortSpec(id="ienv", name="EnvMode", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[
                    PortSpec(id="aleft", name="aLeft", signal_type=SignalType.AUDIO),
                    PortSpec(id="aright", name="aRight", signal_type=SignalType.AUDIO),
                ],
                template=(
                    "{aleft}, {aright} sfplay3 {ivel}, {inotenum}, {xamp}, {xfreq}, {ipreindex}, "
                    "{iflag}, {ioffset}, {ienv}"
                ),
                tags=["soundfont", "sampler", "stereo", "source"],
            ),
            self._spec(
                name="sfinstr3",
                category="soundfont",
                description="Play a SoundFont instrument as stereo audio with cubic interpolation.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="ivel", name="Velocity", signal_type=SignalType.INIT, default=100),
                    PortSpec(id="inotenum", name="MidiNote", signal_type=SignalType.INIT, default=60),
                    PortSpec(
                        id="xamp",
                        name="Amplitude",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=1,
                    ),
                    PortSpec(
                        id="xfreq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=1,
                    ),
                    PortSpec(id="instrnum", name="Instrument", signal_type=SignalType.INIT, default=0),
                    PortSpec(id="ifilhandle", name="FileHandle", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="iflag", name="FreqMode", signal_type=SignalType.INIT, required=False, default=0),
                    PortSpec(id="ioffset", name="Offset", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[
                    PortSpec(id="aleft", name="aLeft", signal_type=SignalType.AUDIO),
                    PortSpec(id="aright", name="aRight", signal_type=SignalType.AUDIO),
                ],
                template=(
                    "{aleft}, {aright} sfinstr3 {ivel}, {inotenum}, {xamp}, {xfreq}, {instrnum}, "
                    "{ifilhandle}, {iflag}, {ioffset}"
                ),
                tags=["soundfont", "sampler", "stereo", "source"],
            ),
            self._spec(
                name="cpsmidi",
                category="midi",
                description="Read active MIDI note pitch as cycles-per-second.",
                icon=self._icon("cpsmidi.svg"),
                inputs=[],
                outputs=[PortSpec(id="kfreq", name="iFreq", signal_type=SignalType.INIT)],
                template="{kfreq} cpsmidi",
                tags=["performance", "source"],
            ),
            self._spec(
                name="ampmidi",
                category="midi",
                description="Generate init-rate amplitude from MIDI note velocity.",
                icon=self._icon("midictrl.svg"),
                inputs=[
                    PortSpec(id="iscal", name="Scale", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="ifn", name="FunctionTable", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="iamp", name="iAmp", signal_type=SignalType.INIT)],
                template="{iamp} ampmidi {iscal}, {ifn}",
                tags=["performance", "midi", "velocity", "amplitude"],
            ),
            self._spec(
                name="ampmidicurve",
                category="midi",
                description="Map MIDI velocity to gain using dynamic range and curve exponent.",
                icon=self._icon("midictrl.svg"),
                inputs=[
                    PortSpec(id="kvelocity", name="Velocity", signal_type=SignalType.CONTROL, default=100),
                    PortSpec(id="kdynamicrange", name="DynamicRangeDb", signal_type=SignalType.CONTROL, default=48),
                    PortSpec(id="kexponent", name="Exponent", signal_type=SignalType.CONTROL, default=1),
                ],
                outputs=[PortSpec(id="kgain", name="kGain", signal_type=SignalType.CONTROL)],
                template="{kgain} ampmidicurve {kvelocity}, {kdynamicrange}, {kexponent}",
                tags=["performance", "midi", "velocity", "amplitude", "curve"],
            ),
            self._spec(
                name="ampmidid",
                category="midi",
                description="Map MIDI velocity to amplitude using a decibel range.",
                icon=self._icon("midictrl.svg"),
                inputs=[
                    PortSpec(id="kvelocity", name="Velocity", signal_type=SignalType.CONTROL, default=100),
                    PortSpec(id="idecibels", name="MaxDb", signal_type=SignalType.INIT, default=0),
                ],
                outputs=[PortSpec(id="kamplitude", name="kAmplitude", signal_type=SignalType.CONTROL)],
                template="{kamplitude} ampmidid {kvelocity}, {idecibels}",
                tags=["performance", "midi", "velocity", "amplitude", "db"],
            ),
            self._spec(
                name="midictrl",
                category="midi",
                description="Read a MIDI controller value with optional scaling.",
                icon=self._icon("midictrl.svg"),
                inputs=[
                    PortSpec(id="inum", name="Controller", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="imin", name="Min", signal_type=SignalType.INIT, required=False, default=0),
                    PortSpec(id="imax", name="Max", signal_type=SignalType.INIT, required=False, default=127),
                ],
                outputs=[PortSpec(id="kval", name="kVal", signal_type=SignalType.CONTROL)],
                template="{kval} midictrl {inum}, {imin}, {imax}",
                tags=["performance", "modulation"],
            ),
            self._spec(
                name="notnum",
                category="midi",
                description="Read the MIDI note number for the current note event.",
                icon=self._icon("midi_note.svg"),
                inputs=[],
                outputs=[PortSpec(id="inote", name="iNote", signal_type=SignalType.INIT)],
                template="{inote} notnum",
                tags=["performance", "midi", "note", "pitch"],
            ),
            self._spec(
                name="k_mul",
                category="math",
                description="Multiply two control signals.",
                icon=self._icon("k_mul.svg"),
                inputs=[
                    PortSpec(id="a", name="A", signal_type=SignalType.CONTROL),
                    PortSpec(id="b", name="B", signal_type=SignalType.CONTROL),
                ],
                outputs=[PortSpec(id="kout", name="kOut", signal_type=SignalType.CONTROL)],
                template="{kout} = ({a}) * ({b})",
                tags=["utility"],
            ),
            self._spec(
                name="a_mul",
                category="math",
                description="Multiply two audio signals.",
                icon=self._icon("a_mul.svg"),
                inputs=[
                    PortSpec(id="a", name="A", signal_type=SignalType.AUDIO),
                    PortSpec(id="b", name="B", signal_type=SignalType.AUDIO),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} = ({a}) * ({b})",
                tags=["utility"],
            ),
            self._spec(
                name="k_to_a",
                category="utility",
                description="Interpolate control signal to audio-rate.",
                icon=self._icon("k_to_a.svg"),
                inputs=[PortSpec(id="kin", name="kIn", signal_type=SignalType.CONTROL)],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} interp {kin}",
                tags=["conversion"],
            ),
            self._spec(
                name="upsamp",
                category="utility",
                description="Convert a control signal to audio-rate by repeating k-values.",
                icon=self._icon("k_to_a.svg"),
                inputs=[
                    PortSpec(
                        id="ksig",
                        name="kIn",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=0,
                    )
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} upsamp {ksig}",
                tags=["conversion", "utility"],
            ),
            self._spec(
                name="downsamp",
                category="utility",
                description="Convert an audio signal to control-rate by downsampling.",
                icon=self._icon("k_to_a.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="iwlen",
                        name="WindowLen",
                        signal_type=SignalType.INIT,
                        required=False,
                        default=0,
                    ),
                ],
                outputs=[PortSpec(id="kout", name="kOut", signal_type=SignalType.CONTROL)],
                template="{kout} downsamp {asig}, {iwlen}",
                tags=["conversion", "utility"],
            ),
            self._spec(
                name="rms",
                category="analysis",
                description="RMS envelope follower for an audio signal.",
                icon=self._icon("k_to_a.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(id="ihp", name="HalfPowerHz", signal_type=SignalType.INIT, required=False, default=10),
                    PortSpec(id="iskip", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="krms", name="kRms", signal_type=SignalType.CONTROL)],
                template="{krms} rms {asig}, {ihp}, {iskip}",
                tags=["analysis", "meter", "envelope", "control"],
            ),
            self._spec(
                name="moogladder",
                category="filter",
                description="Moog ladder low-pass filter.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="ain", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(id="kcf", name="Cutoff", signal_type=SignalType.CONTROL, default=2000),
                    PortSpec(id="kres", name="Resonance", signal_type=SignalType.CONTROL, default=0.2),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} moogladder {ain}, {kcf}, {kres}",
                tags=["tone"],
            ),
            self._spec(
                name="moogladder2",
                category="filter",
                description="Nonlinear Moog-style ladder filter with audio-rate modulation support.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="ain", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="xcf",
                        name="Cutoff",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=2000,
                    ),
                    PortSpec(
                        id="xres",
                        name="Resonance",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=0.2,
                    ),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} moogladder2 {ain}, {xcf}, {xres}",
                tags=["tone", "analog"],
            ),
            self._spec(
                name="moogvcf",
                category="filter",
                description="Moog ladder voltage-controlled filter emulation.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="xfco",
                        name="Cutoff",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=1000,
                    ),
                    PortSpec(
                        id="xres",
                        name="Resonance",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=0.7,
                    ),
                    PortSpec(id="iscale", name="Scale", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="iskip", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} moogvcf {asig}, {xfco}, {xres}, {iscale}, {iskip}",
                tags=["filter", "analog", "resonant", "moog"],
            ),
            self._spec(
                name="diode_ladder",
                category="filter",
                description="Diode ladder low-pass filter model.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="ain", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="xcf",
                        name="Cutoff",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=2000,
                    ),
                    PortSpec(
                        id="xk",
                        name="Resonance",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=0.6,
                    ),
                    PortSpec(id="inlp", name="NLPosition", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="isaturation", name="Saturation", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="istor", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} diode_ladder {ain}, {xcf}, {xk}, {inlp}, {isaturation}, {istor}",
                tags=["tone", "analog"],
            ),
            self._spec(
                name="rezzy",
                category="filter",
                description="Resonant low-pass or high-pass filter.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="ain", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="xfco",
                        name="Cutoff",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=2000,
                    ),
                    PortSpec(
                        id="xres",
                        name="Resonance",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=20,
                    ),
                    PortSpec(id="imode", name="Mode", signal_type=SignalType.INIT, required=False, default=0),
                    PortSpec(id="iskip", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} rezzy {ain}, {xfco}, {xres}, {imode}, {iskip}",
                tags=["tone", "resonant"],
            ),
            self._spec(
                name="vclpf",
                category="filter",
                description="Virtual-analog low-pass filter.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="ain", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="xcf",
                        name="Cutoff",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=1200,
                    ),
                    PortSpec(
                        id="xres",
                        name="Resonance",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=0.2,
                    ),
                    PortSpec(id="istor", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} vclpf {ain}, {xcf}, {xres}, {istor}",
                tags=["tone", "analog"],
            ),
            self._spec(
                name="tbvcf",
                category="filter",
                description="TB-303 style voltage-controlled filter model.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="xfco",
                        name="Cutoff",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=1000,
                    ),
                    PortSpec(
                        id="xres",
                        name="Resonance",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=0.7,
                    ),
                    PortSpec(id="kdist", name="Distortion", signal_type=SignalType.CONTROL, default=2),
                    PortSpec(id="kasym", name="Asymmetry", signal_type=SignalType.CONTROL, default=0.5),
                    PortSpec(id="iskip", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} tbvcf {asig}, {xfco}, {xres}, {kdist}, {kasym}, {iskip}",
                tags=["filter", "resonant", "analog", "tb303"],
            ),
            self._spec(
                name="statevar",
                category="filter",
                description="State-variable filter with simultaneous HP/LP/BP/BR outputs.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="ain", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="xcf",
                        name="Cutoff",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=1200,
                    ),
                    PortSpec(
                        id="xq",
                        name="Q",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=1,
                    ),
                    PortSpec(id="iosamps", name="Oversample", signal_type=SignalType.INIT, required=False, default=0),
                    PortSpec(id="istor", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[
                    PortSpec(id="ahp", name="aHP", signal_type=SignalType.AUDIO),
                    PortSpec(id="alp", name="aLP", signal_type=SignalType.AUDIO),
                    PortSpec(id="abp", name="aBP", signal_type=SignalType.AUDIO),
                    PortSpec(id="abr", name="aBR", signal_type=SignalType.AUDIO),
                ],
                template="{ahp}, {alp}, {abp}, {abr} statevar {ain}, {xcf}, {xq}, {iosamps}, {istor}",
                tags=["filter", "state-variable", "multimode"],
            ),
            self._spec(
                name="skf",
                category="filter",
                description="Sallen-Key low-pass or high-pass filter.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="xcf",
                        name="Cutoff",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=1200,
                    ),
                    PortSpec(
                        id="xk",
                        name="K",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=1.586,
                    ),
                    PortSpec(id="ihp", name="Highpass", signal_type=SignalType.INIT, required=False, default=0),
                    PortSpec(id="istor", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} skf {asig}, {xcf}, {xk}, {ihp}, {istor}",
                tags=["filter", "sallen-key", "lowpass", "highpass"],
            ),
            self._spec(
                name="butterlp",
                category="filter",
                description="Second-order Butterworth low-pass filter.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="xfreq",
                        name="Cutoff",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=1200,
                    ),
                    PortSpec(id="iskip", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} butterlp {asig}, {xfreq}, {iskip}",
                tags=["filter", "butterworth", "lowpass"],
            ),
            self._spec(
                name="butterbp",
                category="filter",
                description="Second-order Butterworth band-pass filter.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="xfreq",
                        name="CenterFreq",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=1200,
                    ),
                    PortSpec(
                        id="xband",
                        name="Bandwidth",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=200,
                    ),
                    PortSpec(id="iskip", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} butterbp {asig}, {xfreq}, {xband}, {iskip}",
                tags=["filter", "butterworth", "bandpass"],
            ),
            self._spec(
                name="butterhp",
                category="filter",
                description="Second-order Butterworth high-pass filter.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="xfreq",
                        name="Cutoff",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=200,
                    ),
                    PortSpec(id="iskip", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} butterhp {asig}, {xfreq}, {iskip}",
                tags=["filter", "butterworth", "highpass"],
            ),
            self._spec(
                name="butterbr",
                category="filter",
                description="Second-order Butterworth band-reject filter.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="xfreq",
                        name="CenterFreq",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=1200,
                    ),
                    PortSpec(
                        id="xband",
                        name="Bandwidth",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=200,
                    ),
                    PortSpec(id="iskip", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} butterbr {asig}, {xfreq}, {xband}, {iskip}",
                tags=["filter", "butterworth", "bandreject"],
            ),
            self._spec(
                name="fofilter",
                category="filter",
                description="Formant filter.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="ain", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="xcf",
                        name="CenterFreq",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=1000,
                    ),
                    PortSpec(
                        id="xris",
                        name="Attack",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=0.003,
                    ),
                    PortSpec(
                        id="xdec",
                        name="Decay",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=0.02,
                    ),
                    PortSpec(id="istor", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} fofilter {ain}, {xcf}, {xris}, {xdec}, {istor}",
                tags=["filter", "formant"],
            ),
            self._spec(
                name="pinker",
                category="noise",
                description="Pink noise generator.",
                icon=self._icon("oscili.svg"),
                inputs=[],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} pinker",
                tags=["noise", "source"],
            ),
            self._spec(
                name="noise",
                category="noise",
                description="Variable-color random audio noise.",
                icon=self._icon("oscili.svg"),
                inputs=[
                    PortSpec(
                        id="amp",
                        name="Amplitude",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=0.25,
                    ),
                    PortSpec(
                        id="beta",
                        name="Color",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=0,
                    ),
                    PortSpec(id="iseed", name="Seed", signal_type=SignalType.INIT, required=False),
                    PortSpec(id="iskip", name="SkipInit", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} noise {amp}, {beta}, {iseed}, {iskip}",
                tags=["noise", "source"],
            ),
            self._spec(
                name="pluck",
                category="physical_modeling",
                description="Karplus-Strong plucked-string model.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="kamp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.3),
                    PortSpec(
                        id="kcps",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=220,
                    ),
                    PortSpec(id="icps", name="InitFrequency", signal_type=SignalType.INIT, default=220),
                    PortSpec(id="ifn", name="FunctionTable", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="imeth", name="Method", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="iparm1", name="MethodParam", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template="{asig} pluck {kamp}, {kcps}, {icps}, {ifn}, {imeth}, {iparm1}",
                tags=["sound", "physical-modeling", "source"],
            ),
            self._spec(
                name="wgpluck2",
                category="physical_modeling",
                description="Waveguide plucked string model with pick and reflection controls.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="iplk", name="PluckPos", signal_type=SignalType.INIT, default=0.75),
                    PortSpec(id="kamp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.3),
                    PortSpec(id="icps", name="InitFrequency", signal_type=SignalType.INIT, default=220),
                    PortSpec(id="kpick", name="PickPos", signal_type=SignalType.CONTROL, default=0.5),
                    PortSpec(id="krefl", name="Reflection", signal_type=SignalType.CONTROL, default=0.95),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template="{asig} wgpluck2 {iplk}, {kamp}, {icps}, {kpick}, {krefl}",
                tags=["sound", "physical-modeling", "source", "pluck"],
            ),
            self._spec(
                name="marimba",
                category="physical_modeling",
                description="Physical model of a marimba bar and resonator.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="kamp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.35),
                    PortSpec(
                        id="kfreq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=440,
                    ),
                    PortSpec(id="ihrd", name="Hardness", signal_type=SignalType.INIT, default=0.5),
                    PortSpec(id="ipos", name="StrikePos", signal_type=SignalType.INIT, default=0.4),
                    PortSpec(id="imp", name="ModeAmount", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="kvibf", name="VibratoRate", signal_type=SignalType.CONTROL, default=6),
                    PortSpec(id="kvamp", name="VibratoDepth", signal_type=SignalType.CONTROL, default=0.01),
                    PortSpec(id="ivibfn", name="VibratoTable", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="idec", name="Decay", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="idoubles", name="DoubleModes", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="itriples", name="TripleModes", signal_type=SignalType.INIT, required=False, default=1),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template=(
                    "{asig} marimba {kamp}, {kfreq}, {ihrd}, {ipos}, {imp}, {kvibf}, {kvamp}, "
                    "{ivibfn}, {idec}, {idoubles}, {itriples}"
                ),
                tags=["sound", "physical-modeling", "source"],
            ),
            self._spec(
                name="dripwater",
                category="physical_modeling",
                description="Stochastic dripping-water physical model source.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="kamp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.2),
                    PortSpec(id="idettack", name="Dettack", signal_type=SignalType.INIT, default=0.09),
                    PortSpec(id="inum", name="Drops", signal_type=SignalType.INIT, required=False, default=10),
                    PortSpec(id="idamp", name="Damping", signal_type=SignalType.INIT, required=False, default=0),
                    PortSpec(id="imaxshake", name="MaxShake", signal_type=SignalType.INIT, required=False, default=0),
                    PortSpec(id="ifreq", name="CenterFreq", signal_type=SignalType.INIT, required=False, default=450),
                    PortSpec(id="ifreq1", name="ResFreq1", signal_type=SignalType.INIT, required=False, default=600),
                    PortSpec(id="ifreq2", name="ResFreq2", signal_type=SignalType.INIT, required=False, default=750),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template="{asig} dripwater {kamp}, {idettack}, {inum}, {idamp}, {imaxshake}, {ifreq}, {ifreq1}, {ifreq2}",
                tags=["sound", "physical-modeling", "source", "noise"],
            ),
            self._spec(
                name="wgflute",
                category="physical_modeling",
                description="Waveguide flute model.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="kamp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.3),
                    PortSpec(
                        id="kfreq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=440,
                    ),
                    PortSpec(id="kjet", name="Jet", signal_type=SignalType.CONTROL, default=0.2),
                    PortSpec(id="iatt", name="Attack", signal_type=SignalType.INIT, default=0.03),
                    PortSpec(id="idetk", name="Detune", signal_type=SignalType.INIT, default=0.1),
                    PortSpec(id="kngain", name="NoiseGain", signal_type=SignalType.CONTROL, default=0.1),
                    PortSpec(id="kvibf", name="VibratoRate", signal_type=SignalType.CONTROL, default=5),
                    PortSpec(id="kvamp", name="VibratoDepth", signal_type=SignalType.CONTROL, default=0.02),
                    PortSpec(id="ifn", name="FunctionTable", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="iminfreq", name="MinFreq", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template=(
                    "{asig} wgflute {kamp}, {kfreq}, {kjet}, {iatt}, {idetk}, {kngain}, "
                    "{kvibf}, {kvamp}, {ifn}, {iminfreq}"
                ),
                tags=["sound", "physical-modeling", "source"],
            ),
            self._spec(
                name="wgclar",
                category="physical_modeling",
                description="Waveguide clarinet model.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="kamp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.3),
                    PortSpec(
                        id="kfreq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=220,
                    ),
                    PortSpec(id="kstiff", name="Stiffness", signal_type=SignalType.CONTROL, default=0.1),
                    PortSpec(id="iatt", name="Attack", signal_type=SignalType.INIT, default=0.03),
                    PortSpec(id="idetk", name="Detune", signal_type=SignalType.INIT, default=0.1),
                    PortSpec(id="kngain", name="NoiseGain", signal_type=SignalType.CONTROL, default=0.1),
                    PortSpec(id="kvibf", name="VibratoRate", signal_type=SignalType.CONTROL, default=5),
                    PortSpec(id="kvamp", name="VibratoDepth", signal_type=SignalType.CONTROL, default=0.02),
                    PortSpec(id="ifn", name="FunctionTable", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="iminfreq", name="MinFreq", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template=(
                    "{asig} wgclar {kamp}, {kfreq}, {kstiff}, {iatt}, {idetk}, {kngain}, "
                    "{kvibf}, {kvamp}, {ifn}, {iminfreq}"
                ),
                tags=["sound", "physical-modeling", "source", "wind"],
            ),
            self._spec(
                name="wgbow",
                category="physical_modeling",
                description="Waveguide bowed-string model.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="kamp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.3),
                    PortSpec(
                        id="kfreq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=220,
                    ),
                    PortSpec(id="kpres", name="BowPressure", signal_type=SignalType.CONTROL, default=3),
                    PortSpec(id="krat", name="BowPos", signal_type=SignalType.CONTROL, default=0.127236),
                    PortSpec(id="kvibf", name="VibratoRate", signal_type=SignalType.CONTROL, default=5),
                    PortSpec(id="kvibamp", name="VibratoDepth", signal_type=SignalType.CONTROL, default=0.01),
                    PortSpec(id="ifn", name="FunctionTable", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="iminfreq", name="MinFreq", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template="{asig} wgbow {kamp}, {kfreq}, {kpres}, {krat}, {kvibf}, {kvibamp}, {ifn}, {iminfreq}",
                tags=["sound", "physical-modeling", "source", "bowed"],
            ),
            self._spec(
                name="wgbowedbar",
                category="physical_modeling",
                description="Waveguide bowed-bar model.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="kamp", name="Amplitude", signal_type=SignalType.CONTROL, default=0.3),
                    PortSpec(
                        id="kfreq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=220,
                    ),
                    PortSpec(id="kpos", name="StrikePos", signal_type=SignalType.CONTROL, default=0.2),
                    PortSpec(id="kbowpres", name="BowPressure", signal_type=SignalType.CONTROL, default=3),
                    PortSpec(id="kgain", name="Gain", signal_type=SignalType.CONTROL, default=0.995),
                    PortSpec(id="const", name="Const", signal_type=SignalType.INIT, required=False, default=1),
                    PortSpec(id="itvel", name="BowVelocity", signal_type=SignalType.INIT, required=False, default=0.5),
                    PortSpec(id="ibowpos", name="BowPos", signal_type=SignalType.INIT, required=False, default=0.14),
                    PortSpec(id="ilow", name="MinFreq", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="asig", name="aSig", signal_type=SignalType.AUDIO)],
                template=(
                    "{asig} wgbowedbar {kamp}, {kfreq}, {kpos}, {kbowpres}, {kgain}, "
                    "{const}, {itvel}, {ibowpos}, {ilow}"
                ),
                tags=["sound", "physical-modeling", "source", "bowed"],
            ),
            self._spec(
                name="wguide2",
                category="physical_modeling",
                description="Two-point waveguide resonator.",
                icon=self._icon("vco.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="xfreq",
                        name="Frequency",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=220,
                    ),
                    PortSpec(
                        id="xcutoff",
                        name="Cutoff",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=4000,
                    ),
                    PortSpec(id="kfeedback", name="Feedback", signal_type=SignalType.CONTROL, default=0.5),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} wguide2 {asig}, {xfreq}, {xcutoff}, {kfeedback}",
                tags=["physical-modeling", "resonator"],
            ),
            self._spec(
                name="delay",
                category="delay",
                description="Simple non-interpolating audio delay line.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(id="idlt", name="DelayTime", signal_type=SignalType.INIT, default=0.25),
                    PortSpec(id="iskip", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} delay {asig}, {idlt}, {iskip}",
                tags=["delay", "effect"],
            ),
            self._spec(
                name="delayk",
                category="delay",
                description="Control-rate delay line.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(
                        id="ksig",
                        name="kIn",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                    ),
                    PortSpec(id="idel", name="DelayTime", signal_type=SignalType.INIT, default=0.1),
                    PortSpec(id="imode", name="Mode", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="kout", name="kOut", signal_type=SignalType.CONTROL)],
                template="{kout} delayk {ksig}, {idel}, {imode}",
                tags=["delay", "utility"],
            ),
            self._spec(
                name="delayr",
                category="delay",
                description="Read tap from a classic delay-line memory buffer.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="idlt", name="DelayTime", signal_type=SignalType.INIT, default=0.25),
                    PortSpec(id="iskip", name="SkipInit", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} delayr {idlt}, {iskip}",
                tags=["delay", "tap"],
            ),
            self._spec(
                name="delayw",
                category="delay",
                description="Write into the delay-line memory buffer.",
                icon=self._icon("moogladder.svg"),
                inputs=[PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO)],
                outputs=[],
                template="delayw {asig}",
                tags=["delay", "tap", "sink"],
            ),
            self._spec(
                name="deltap",
                category="delay",
                description="Read a delay tap using linear interpolation.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(
                        id="kdlt",
                        name="DelayTime",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=0.1,
                    )
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} deltap {kdlt}",
                tags=["delay", "tap"],
            ),
            self._spec(
                name="deltap3",
                category="delay",
                description="Read a delay tap using cubic interpolation.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(
                        id="xdlt",
                        name="DelayTime",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=0.1,
                    )
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} deltap3 {xdlt}",
                tags=["delay", "tap"],
            ),
            self._spec(
                name="vdelayxs",
                category="delay",
                description="Variable delay with high-quality sinc interpolation.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(id="adl", name="DelayTime", signal_type=SignalType.AUDIO, default=0.02),
                    PortSpec(id="imaxdel", name="MaxDelay", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="isize", name="SincSize", signal_type=SignalType.INIT, default=4),
                    PortSpec(id="iws", name="WindowSize", signal_type=SignalType.INIT, required=False, default=1024),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} vdelayxs {asig}, {adl}, {imaxdel}, {isize}, {iws}",
                tags=["delay", "effect"],
            ),
            self._spec(
                name="vdelay3",
                category="delay",
                description="Variable delay line with cubic interpolation.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="adel",
                        name="DelayTime",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=20,
                    ),
                    PortSpec(id="imd", name="MaxDelay", signal_type=SignalType.INIT, default=100),
                    PortSpec(id="iws", name="WindowSize", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} vdelay3 {asig}, {adel}, {imd}, {iws}",
                tags=["delay", "effect"],
            ),
            self._spec(
                name="flanger",
                category="delay",
                description="Flanger effect with delay modulation and feedback.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="adel",
                        name="DelayTime",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=3,
                    ),
                    PortSpec(id="kfeedback", name="Feedback", signal_type=SignalType.CONTROL, default=0.3),
                    PortSpec(id="imaxd", name="MaxDelay", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} flanger {asig}, {adel}, {kfeedback}, {imaxd}",
                tags=["delay", "effect"],
            ),
            self._spec(
                name="comb",
                category="delay",
                description="Comb filter / feedback delay.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(id="krvt", name="ReverbTime", signal_type=SignalType.CONTROL, default=2),
                    PortSpec(id="ilpt", name="LoopTime", signal_type=SignalType.INIT, default=0.05),
                    PortSpec(id="iskip", name="SkipInit", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} comb {asig}, {krvt}, {ilpt}, {iskip}",
                tags=["delay", "effect"],
            ),
            self._spec(
                name="reverb2",
                category="reverb",
                description="Schroeder reverb processor.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(id="krvt", name="ReverbTime", signal_type=SignalType.CONTROL, default=1.5),
                    PortSpec(id="khf", name="HighFreqDamp", signal_type=SignalType.CONTROL, default=0.5),
                    PortSpec(id="iskip", name="SkipInit", signal_type=SignalType.INIT, required=False),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} reverb2 {asig}, {krvt}, {khf}, {iskip}",
                tags=["reverb", "effect"],
            ),
            self._spec(
                name="platerev",
                category="reverb",
                description="Physical-model plate reverb with stereo output taps.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="itabexcite", name="ExciteTable", signal_type=SignalType.INIT),
                    PortSpec(id="itabouts", name="OutputTable", signal_type=SignalType.INIT),
                    PortSpec(id="kbndry", name="Boundary", signal_type=SignalType.CONTROL, default=1),
                    PortSpec(id="iaspect", name="Aspect", signal_type=SignalType.INIT, default=0.73),
                    PortSpec(id="istiff", name="Stiffness", signal_type=SignalType.INIT, default=1),
                    PortSpec(id="idecay", name="Decay", signal_type=SignalType.INIT, default=5),
                    PortSpec(id="iloss", name="Loss", signal_type=SignalType.INIT, default=0.001),
                    PortSpec(id="aexcite1", name="aExcite1", signal_type=SignalType.AUDIO, default=0),
                    PortSpec(id="aexcite2", name="aExcite2", signal_type=SignalType.AUDIO, required=False, default=0),
                ],
                outputs=[
                    PortSpec(id="aleft", name="aLeft", signal_type=SignalType.AUDIO),
                    PortSpec(id="aright", name="aRight", signal_type=SignalType.AUDIO),
                ],
                template=(
                    "{aleft}, {aright} platerev {itabexcite}, {itabouts}, {kbndry}, {iaspect}, {istiff}, "
                    "{idecay}, {iloss}, {aexcite1}, {aexcite2}"
                ),
                tags=["reverb", "effect", "plate", "stereo", "physical-modeling"],
            ),
            self._spec(
                name="limit",
                category="dynamics",
                description="Hard clamp limiter.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(
                        id="xin",
                        name="Input",
                        signal_type=SignalType.AUDIO,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                    ),
                    PortSpec(
                        id="xmin",
                        name="Min",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=-0.8,
                    ),
                    PortSpec(
                        id="xmax",
                        name="Max",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=0.8,
                    ),
                ],
                outputs=[PortSpec(id="xout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{xout} limit {xin}, {xmin}, {xmax}",
                tags=["dynamics", "utility"],
            ),
            self._spec(
                name="dam",
                category="dynamics",
                description="Dynamic amplitude processor (downward compressor/noise suppressor).",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="ain", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="kthreshold",
                        name="Threshold",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=0.5,
                    ),
                    PortSpec(id="icomp1", name="Comp1", signal_type=SignalType.INIT, default=0.1),
                    PortSpec(id="icomp2", name="Comp2", signal_type=SignalType.INIT, default=0.9),
                    PortSpec(id="irtime", name="RiseTime", signal_type=SignalType.INIT, default=0.01),
                    PortSpec(id="iftime", name="FallTime", signal_type=SignalType.INIT, default=0.1),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} dam {ain}, {kthreshold}, {icomp1}, {icomp2}, {irtime}, {iftime}",
                tags=["dynamics", "processor"],
            ),
            self._spec(
                name="exciter",
                category="filter",
                description="Harmonic exciter that adds controlled upper partials.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="kfreq",
                        name="Freq",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=2500,
                    ),
                    PortSpec(
                        id="kceil",
                        name="Ceiling",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=12000,
                    ),
                    PortSpec(
                        id="kharmonics",
                        name="Harmonics",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=1,
                    ),
                    PortSpec(
                        id="kblend",
                        name="Blend",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=0.5,
                    ),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} exciter {asig}, {kfreq}, {kceil}, {kharmonics}, {kblend}",
                tags=["effect", "harmonic", "enhancer"],
            ),
            self._spec(
                name="distort1",
                category="distortion",
                description="Waveshaping distortion with configurable transfer curve.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="kpregain",
                        name="PreGain",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=2,
                    ),
                    PortSpec(
                        id="kpostgain",
                        name="PostGain",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=0.5,
                    ),
                    PortSpec(
                        id="kshape1",
                        name="Shape1",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=0,
                    ),
                    PortSpec(
                        id="kshape2",
                        name="Shape2",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=0,
                    ),
                    PortSpec(id="imode", name="Mode", signal_type=SignalType.INIT, required=False, default=1),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} distort1 {asig}, {kpregain}, {kpostgain}, {kshape1}, {kshape2}, {imode}",
                tags=["effect", "saturation", "waveshaper"],
            ),
            self._spec(
                name="fold",
                category="distortion",
                description="Artificial foldover effect for audio signals.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="kincr",
                        name="FoldAmount",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=2,
                    ),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} fold {asig}, {kincr}",
                tags=["effect", "foldover", "lofi"],
            ),
            self._spec(
                name="clip",
                category="distortion",
                description="Signal clipper with selectable transfer curves.",
                icon=self._icon("moogladder.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(id="imeth", name="Method", signal_type=SignalType.INIT, default=0),
                    PortSpec(id="ilimit", name="Limit", signal_type=SignalType.INIT, default=0.8),
                    PortSpec(id="iarg", name="ShapeArg", signal_type=SignalType.INIT, required=False, default=0.5),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} clip {asig}, {imeth}, {ilimit}, {iarg}",
                tags=["effect", "clipping", "waveshaper"],
            ),
            self._spec(
                name="pan2",
                category="mixer",
                description="Stereo panner.",
                icon=self._icon("mix2.svg"),
                inputs=[
                    PortSpec(id="asig", name="aIn", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="xp",
                        name="Pan",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.AUDIO, SignalType.CONTROL, SignalType.INIT],
                        default=0.5,
                    ),
                    PortSpec(id="imode", name="Mode", signal_type=SignalType.INIT, required=False, default=0),
                ],
                outputs=[
                    PortSpec(id="aleft", name="aLeft", signal_type=SignalType.AUDIO),
                    PortSpec(id="aright", name="aRight", signal_type=SignalType.AUDIO),
                ],
                template="{aleft}, {aright} pan2 {asig}, {xp}, {imode}",
                tags=["mix", "stereo", "utility"],
            ),
            self._spec(
                name="mix2",
                category="mixer",
                description="Mix two audio signals.",
                icon=self._icon("mix2.svg"),
                inputs=[
                    PortSpec(id="a", name="Left", signal_type=SignalType.AUDIO),
                    PortSpec(id="b", name="Right", signal_type=SignalType.AUDIO),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} = ({a}) + ({b})",
                tags=["mix"],
            ),
            self._spec(
                name="ntrpol",
                category="mixer",
                description="Linear crossfade between two audio signals.",
                icon=self._icon("mix2.svg"),
                inputs=[
                    PortSpec(id="asig1", name="aIn1", signal_type=SignalType.AUDIO),
                    PortSpec(id="asig2", name="aIn2", signal_type=SignalType.AUDIO),
                    PortSpec(
                        id="kpoint",
                        name="Mix",
                        signal_type=SignalType.CONTROL,
                        accepted_signal_types=[SignalType.CONTROL, SignalType.INIT],
                        default=0.5,
                    ),
                ],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} ntrpol {asig1}, {asig2}, {kpoint}",
                tags=["mix", "crossfade", "interpolation"],
            ),
            self._spec(
                name="outs",
                category="output",
                description="Stereo output sink.",
                icon=self._icon("outs.svg"),
                inputs=[
                    PortSpec(id="left", name="Left", signal_type=SignalType.AUDIO),
                    PortSpec(id="right", name="Right", signal_type=SignalType.AUDIO),
                ],
                outputs=[],
                template="outs {left}, {right}",
                tags=["sink"],
            ),
            self._spec(
                name="outletk",
                category="routing",
                description="Send a control-rate signal to a named instrument outlet port.",
                icon=self._icon("outs.svg"),
                inputs=[
                    PortSpec(id="sname", name="PortName", signal_type=SignalType.STRING),
                    PortSpec(id="ksignal", name="kSignal", signal_type=SignalType.CONTROL),
                ],
                outputs=[],
                template="outletk {sname}, {ksignal}",
                tags=["routing", "sink", "control", "interconnect"],
            ),
            self._spec(
                name="outleta",
                category="routing",
                description="Send an audio-rate signal to a named instrument outlet port.",
                icon=self._icon("outs.svg"),
                inputs=[
                    PortSpec(id="sname", name="PortName", signal_type=SignalType.STRING),
                    PortSpec(id="asignal", name="aSignal", signal_type=SignalType.AUDIO),
                ],
                outputs=[],
                template="outleta {sname}, {asignal}",
                tags=["routing", "sink", "audio", "interconnect"],
            ),
            self._spec(
                name="inletk",
                category="routing",
                description="Receive a control-rate signal from a named instrument inlet port.",
                icon=self._icon("k_to_a.svg"),
                inputs=[PortSpec(id="sname", name="PortName", signal_type=SignalType.STRING)],
                outputs=[PortSpec(id="ksignal", name="kSignal", signal_type=SignalType.CONTROL)],
                template="{ksignal} inletk {sname}",
                tags=["routing", "source", "control", "interconnect"],
            ),
            self._spec(
                name="inleta",
                category="routing",
                description="Receive an audio-rate signal from a named instrument inlet port.",
                icon=self._icon("outs.svg"),
                inputs=[PortSpec(id="sname", name="PortName", signal_type=SignalType.STRING)],
                outputs=[PortSpec(id="asignal", name="aSignal", signal_type=SignalType.AUDIO)],
                template="{asignal} inleta {sname}",
                tags=["routing", "source", "audio", "interconnect"],
            ),
            self._spec(
                name="const_k",
                category="constants",
                description="Control-rate constant value.",
                icon=self._icon("const_k.svg"),
                inputs=[],
                outputs=[PortSpec(id="kout", name="kOut", signal_type=SignalType.CONTROL)],
                template="{kout} = {value}",
                tags=["source"],
            ),
            self._spec(
                name="const_i",
                category="constants",
                description="Init-rate constant value.",
                icon=self._icon("const_i.svg"),
                inputs=[],
                outputs=[PortSpec(id="iout", name="iOut", signal_type=SignalType.INIT)],
                template="{iout} = {value}",
                tags=["source"],
            ),
            self._spec(
                name="const_a",
                category="constants",
                description="Audio-rate constant value.",
                icon=self._icon("const_a.svg"),
                inputs=[],
                outputs=[PortSpec(id="aout", name="aOut", signal_type=SignalType.AUDIO)],
                template="{aout} = {value}",
                tags=["source"],
            ),
        ]
